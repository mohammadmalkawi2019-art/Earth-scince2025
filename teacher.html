<!doctype html><html lang="ar"><head><meta charset="utf-8"><meta name="viewport" content="width=device-width,initial-scale=1"><title>لوحة المعلّم</title><link rel="stylesheet" href="style.css"></head><body>
<div class="container">
  <h1>لوحة المعلّم</h1>
  <p class="small">تعرض النتائج المحفوظة محليًا على هذا المتصفح (LocalStorage).</p>
  <div id="teacherData">لا توجد بيانات محلية.</div>
  <div style="margin-top:12px"><button id="refresh">تحديث</button><button id="clearLocal">حذف البيانات</button><a id="downloadCSV" style="margin-left:8px">تحميل CSV</a></div>
  <div class="footer">إعداد المعلم: محمد ملكاوي</div>
</div>
<script>
function renderData(){ const raw = localStorage.getItem('exam_results') || '[]'; let arr = []; try{ arr = JSON.parse(raw);}catch(e){ arr = []; } const c = document.getElementById('teacherData'); if(!arr.length){ c.innerHTML = '<div class="small">لا توجد بيانات محلية على هذا المتصفح.</div>'; return; } let html = '<table style="width:100%;border-collapse:collapse"><tr><th>الاسم</th><th>الوحدة</th><th>الدرجة%</th><th>الدرجات</th><th>التاريخ</th></tr>'; arr.forEach(r=>{ html += '<tr style="border-top:1px solid #eee"><td>'+r.name+'</td><td>'+r.unit+'</td><td>'+r.score+'</td><td>'+r.correct+' / '+r.total+'</td><td>'+new Date(r.date).toLocaleString()+'</td></tr>'; }); html += '</table>'; c.innerHTML = html; } document.getElementById('refresh').addEventListener('click', renderData); document.getElementById('clearLocal').addEventListener('click', ()=>{ if(confirm('حذف جميع النتائج المحلية من هذا المتصفح؟')){ localStorage.removeItem('exam_results'); renderData(); }}); document.getElementById('downloadCSV').addEventListener('click', ()=>{ const raw = localStorage.getItem('exam_results') || '[]'; let arr = []; try{ arr = JSON.parse(raw);}catch(e){ arr = []; } if(!arr.length){ alert('لا توجد بيانات'); return; } const rows=[['name','unit','score','correct','total','date']]; arr.forEach(r=> rows.push([r.name,r.unit,r.score,r.correct,r.total,r.date])); const csv = rows.map(r=> r.map(c=> '"'+String(c).replace(/"/g,'""')+'"').join(',')).join('\n'); const blob = new Blob([csv], {type:'text/csv;charset=utf-8;'}); const url = URL.createObjectURL(blob); const a = document.createElement('a'); a.href = url; a.download = 'exam_results_local.csv'; a.click(); URL.revokeObjectURL(url); });</script></body></html>
